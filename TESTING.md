# Testing Documentation

This document outlines the comprehensive testing strategy for the University Job Bank application, including unit tests, integration tests, end-to-end tests, and deployment validation.

## Test Structure

```
├── src/__tests__/           # Unit tests
│   ├── components/          # Component tests
│   ├── hooks/              # Hook tests
│   ├── lib/                # Library function tests
│   └── contexts/           # Context tests
├── e2e/                    # End-to-end tests
│   ├── auth.setup.ts       # Authentication setup
│   ├── critical-user-flows.spec.ts
│   ├── production-deployment.spec.ts
│   └── integration-tests.spec.ts
└── scripts/                # Test utilities
    ├── validate-deployment.js
    └── validate-production.js
```

## Test Types

### 1. Unit Tests (Jest + React Testing Library)

Unit tests focus on individual components, hooks, and utility functions in isolation.

**Run unit tests:**
```bash
npm run test          # Run once
npm run test:watch    # Watch mode
npm run test:ci       # CI mode with coverage
```

**Coverage areas:**
- Component rendering and user interactions
- Custom hooks behavior
- Utility functions
- Authentication logic
- Data validation
- API client functions

### 2. Integration Tests (Playwright)

Integration tests verify that different parts of the system work together correctly.

**Run integration tests:**
```bash
npm run test:integration
```

**Coverage areas:**
- Supabase database integration
- Authentication flow with Supabase Auth
- File upload to Supabase Storage
- Real-time updates
- Email notification triggers
- Role-based access control
- Search and filtering functionality

### 3. End-to-End Tests (Playwright)

E2E tests simulate real user workflows across the entire application.

**Run E2E tests:**
```bash
npm run test:e2e           # Headless mode
npm run test:e2e:headed    # With browser UI
npm run test:e2e:ui        # Interactive UI mode
```

**Critical user flows tested:**
- User registration and login
- Faculty job posting creation
- Student job search and application
- Application management by faculty
- Notification system
- Profile management
- Admin functions
- Mobile responsiveness
- Error handling

### 4. Production Deployment Tests

These tests validate the production environment and deployment pipeline.

**Run production tests:**
```bash
npm run test:production
```

**Coverage areas:**
- Production environment health
- Database connectivity
- File storage integration
- Email service integration
- Performance benchmarks
- Security headers
- SEO and accessibility
- Error handling in production

## Test Data Setup

### Authentication Test Users

The tests use predefined test users with different roles:

- **Faculty**: `faculty@acadiau.ca` / `testpassword123`
- **Student**: `student@acadiau.ca` / `testpassword123`
- **Admin**: `admin@acadiau.ca` / `testpassword123`

### Test Database

Tests run against a dedicated test database to avoid affecting production data. The test database is seeded with:

- Sample job postings
- Test user profiles
- Application records
- Notification data

## Continuous Integration

### GitHub Actions Workflow

The deployment tests run automatically on:
- Push to main/develop branches
- Pull requests to main
- Daily schedule (2 AM UTC)

**Workflow stages:**
1. **Pre-deployment tests**: TypeScript, linting, unit tests, build
2. **E2E tests**: Full application testing in development mode
3. **Production tests**: Validation against live production environment
4. **Performance tests**: Lighthouse CI for Core Web Vitals

### Test Reports

- **Unit test coverage**: Generated by Jest
- **E2E test reports**: Playwright HTML reports
- **Performance reports**: Lighthouse CI reports
- **Security audit**: npm audit results

## Running Tests Locally

### Prerequisites

1. Install dependencies:
   ```bash
   npm install
   ```

2. Install Playwright browsers:
   ```bash
   npx playwright install
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env.local
   # Fill in your Supabase credentials
   ```

### Development Workflow

1. **During development**: Run unit tests in watch mode
   ```bash
   npm run test:watch
   ```

2. **Before committing**: Run all tests
   ```bash
   npm run test:all
   ```

3. **Before deployment**: Run deployment validation
   ```bash
   npm run validate:deployment
   ```

## Test Configuration

### Jest Configuration (`jest.config.js`)

- Uses Next.js Jest configuration
- JSDOM environment for React components
- Module path mapping for imports
- Setup file for testing utilities

### Playwright Configuration (`playwright.config.ts`)

- Multi-browser testing (Chrome, Firefox, Safari)
- Mobile device testing
- Parallel test execution
- Automatic retry on failure
- Trace collection for debugging

### Lighthouse CI Configuration (`lighthouserc.js`)

- Performance thresholds
- Accessibility requirements
- SEO validation
- Best practices checks

## Debugging Tests

### Unit Tests

```bash
# Run specific test file
npm test -- auth.test.ts

# Run tests matching pattern
npm test -- --testNamePattern="login"

# Debug mode
npm test -- --detectOpenHandles --forceExit
```

### E2E Tests

```bash
# Run specific test file
npx playwright test critical-user-flows.spec.ts

# Debug mode with browser
npx playwright test --debug

# Run with trace
npx playwright test --trace on
```

### Viewing Test Reports

```bash
# Open Playwright report
npx playwright show-report

# Open Jest coverage report
open coverage/lcov-report/index.html
```

## Performance Testing

### Metrics Tracked

- **First Contentful Paint (FCP)**: < 2.5s
- **Largest Contentful Paint (LCP)**: < 4s
- **Cumulative Layout Shift (CLS)**: < 0.1
- **Time to Interactive (TTI)**: < 5s

### Load Testing

The tests simulate:
- Concurrent user sessions
- Large dataset handling
- File upload performance
- Database query efficiency

## Security Testing

### Automated Checks

- **npm audit**: Dependency vulnerability scanning
- **Authentication**: University email validation
- **Authorization**: Role-based access control
- **Data validation**: Input sanitization
- **File uploads**: Type and size validation

### Manual Security Review

Regular security reviews should cover:
- Supabase RLS policies
- API endpoint security
- Client-side data exposure
- Session management
- CORS configuration

## Maintenance

### Updating Tests

1. **When adding features**: Add corresponding unit and E2E tests
2. **When changing UI**: Update selectors and assertions
3. **When modifying API**: Update integration tests
4. **When changing auth**: Update authentication setup

### Test Data Management

- **Seed data**: Keep test database seeded with consistent data
- **Cleanup**: Ensure tests clean up after themselves
- **Isolation**: Tests should not depend on each other

### Performance Monitoring

- Monitor test execution time
- Update performance thresholds as needed
- Optimize slow tests
- Parallelize where possible

## Troubleshooting

### Common Issues

1. **Flaky tests**: Add proper waits and retries
2. **Slow tests**: Optimize selectors and reduce unnecessary waits
3. **Authentication failures**: Check test user credentials
4. **Database issues**: Verify test database connection
5. **File upload failures**: Check storage configuration

### Getting Help

- Check test logs and reports
- Use Playwright trace viewer for E2E issues
- Review Jest error messages for unit tests
- Consult team documentation and runbooks